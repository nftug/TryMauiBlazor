@using TryMauiBlazor.Services

@implements IDisposable

@inject LayoutService LayoutService
@inject NavigationService NavigationService

<MudAppBar Elevation="0" Fixed>
    <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@DrawerToggleCallback" />
    <MudText Typo="Typo.h6" Class="ml-3">@NavigationService.Title</MudText>

    <MudSpacer />

    <MudTooltip Duration="1000" Text="@(LayoutService.IsDarkMode ? "Light mode" : "Dark mode")">
        <MudIconButton Icon="@(LayoutService.IsDarkMode ? @Icons.Rounded.LightMode : @Icons.Material.Outlined.DarkMode)"
                       Color="Color.Inherit" OnClick="@LayoutService.ToggleDarkMode" />
    </MudTooltip>
</MudAppBar>

@code {
    [Parameter]
    public EventCallback<MouseEventArgs> DrawerToggleCallback { get; set; }

    protected override void OnInitialized()
    {
        NavigationService.TitleChanged += OnTitleChanged;
    }

    public void Dispose()
    {
        NavigationService.TitleChanged -= OnTitleChanged;
    }

    public void OnTitleChanged() => InvokeAsync(StateHasChanged);
}
